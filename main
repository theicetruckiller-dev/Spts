--// SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local Player = Players.LocalPlayer

--// GUI ROOT
local gui = Instance.new("ScreenGui")
gui.Name = "SPTSAuto"
gui.ResetOnSpawn = false
gui.Parent = Player:WaitForChild("PlayerGui")

--// PANEL
local panel = Instance.new("Frame", gui)
panel.Size = UDim2.new(0, 360, 0, 380)
panel.Position = UDim2.new(0.05, 0, 0.5, 0)
panel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
panel.Active = true
panel.Draggable = true
Instance.new("UICorner", panel).CornerRadius = UDim.new(0, 12)

--// CATEGORY BUTTONS
local categories = {"Clicker", "Teleports", "Farms", "Misc"}
local categoryFrames = {}
local selectedCategory = "Clicker"

for i, cat in ipairs(categories) do
    local btn = Instance.new("TextButton", panel)
    btn.Size = UDim2.new(0, 80, 0, 28)
    btn.Position = UDim2.new(0, 10 + (i-1)*90, 0, 10)
    btn.Text = cat
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(230,230,230)
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

    local frame = Instance.new("Frame", panel)
    frame.Size = UDim2.new(1, -20, 1, -50)
    frame.Position = UDim2.new(0, 10, 0, 50)
    frame.BackgroundTransparency = 1
    frame.Visible = i == 1
    categoryFrames[cat] = frame

    btn.MouseButton1Click:Connect(function()
        selectedCategory = cat
        for k,v in pairs(categoryFrames) do
            v.Visible = k == cat
        end
    end)
end

--// CLICKER CATEGORY
local clickFrame = categoryFrames["Clicker"]
local clickerBtn = Instance.new("TextButton", clickFrame)
clickerBtn.Size = UDim2.new(0, 120, 0, 32)
clickerBtn.Position = UDim2.new(0,10,0,10)
clickerBtn.BackgroundColor3 = Color3.fromRGB(40,180,100)
clickerBtn.Text = "Clicker: Off"
clickerBtn.TextColor3 = Color3.fromRGB(240,240,240)
clickerBtn.Font = Enum.Font.GothamBold
clickerBtn.TextSize = 14
Instance.new("UICorner", clickerBtn).CornerRadius = UDim.new(0,8)

local speedBox = Instance.new("TextBox", clickFrame)
speedBox.Size = UDim2.new(0,60,0,26)
speedBox.Position = UDim2.new(0,140,0,10)
speedBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
speedBox.Text = "100"
speedBox.TextColor3 = Color3.fromRGB(220,220,220)
speedBox.Font = Enum.Font.Gotham
speedBox.TextSize = 14
speedBox.ClearTextOnFocus = false
Instance.new("UICorner", speedBox).CornerRadius = UDim.new(0,6)

local clickerActive = false
local clickPosition = Vector2.new(401, 270) -- default
clickerBtn.MouseButton1Click:Connect(function()
    clickerActive = not clickerActive
    clickerBtn.Text = clickerActive and "Clicker: On" or "Clicker: Off"
    clickerBtn.BackgroundColor3 = clickerActive and Color3.fromRGB(200,80,80) or Color3.fromRGB(40,180,100)
end)

--// TELEPORT CATEGORY
local tpFrame = categoryFrames["Teleports"]
local pools = {
    Vector3.new(366,250,-446),
    Vector3.new(348,264,-499),
    Vector3.new(1639,260,2250),
    Vector3.new(-2303,977,1072),
    Vector3.new(-2051,714,-1893)
}
local selectedPool = 1
local autoPoolActive = false
local hasTeleported = false
local lastPos = nil

local poolBtns = {}
for i=1,#pools do
    local b = Instance.new("TextButton", tpFrame)
    b.Size = UDim2.new(0,60,0,26)
    b.Position = UDim2.new(0,10+70*(i-1),0,10)
    b.BackgroundColor3 = Color3.fromRGB(70,70,70)
    b.TextColor3 = i==1 and Color3.fromRGB(100,170,255) or Color3.fromRGB(230,230,230)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 14
    b.Text = "Pool "..i
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
    b.MouseButton1Click:Connect(function()
        selectedPool=i
        for j,btn in ipairs(poolBtns) do
            btn.TextColor3= j==i and Color3.fromRGB(100,170,255) or Color3.fromRGB(230,230,230)
        end
        hasTeleported=false
    end)
    table.insert(poolBtns, b)
end

local autoPoolBtn = Instance.new("TextButton", tpFrame)
autoPoolBtn.Size = UDim2.new(0,150,0,28)
autoPoolBtn.Position = UDim2.new(0,10,0,50)
autoPoolBtn.BackgroundColor3 = Color3.fromRGB(200,120,50)
autoPoolBtn.Text = "Auto Pool: Off"
autoPoolBtn.TextColor3 = Color3.fromRGB(240,240,240)
autoPoolBtn.Font = Enum.Font.GothamBold
autoPoolBtn.TextSize = 14
Instance.new("UICorner", autoPoolBtn).CornerRadius = UDim.new(0,8)
autoPoolBtn.MouseButton1Click:Connect(function()
    autoPoolActive = not autoPoolActive
    autoPoolBtn.Text = autoPoolActive and "Auto Pool: On" or "Auto Pool: Off"
    hasTeleported=false
end)

--// MISC CATEGORY (1,2,3 items)
local miscFrame = categoryFrames["Misc"]
local itemStates = {[1]=false,[2]=false,[3]=false}
for i=1,3 do
    local b = Instance.new("TextButton", miscFrame)
    b.Size = UDim2.new(0,50,0,28)
    b.Position = UDim2.new(0,10 + (i-1)*60,0,10)
    b.Text = tostring(i)
    b.Font = Enum.Font.GothamBold
    b.TextSize = 14
    b.BackgroundColor3 = Color3.fromRGB(70,70,70)
    b.TextColor3 = Color3.fromRGB(230,230,230)
    Instance.new("UICorner",b).CornerRadius = UDim.new(0,6)
    b.MouseButton1Click:Connect(function()
        itemStates[i] = not itemStates[i]
        b.BackgroundColor3 = itemStates[i] and Color3.fromRGB(50,150,250) or Color3.fromRGB(70,70,70)
    end)
end

--// RUN LOOPS
-- Auto Clicker
RunService.RenderStepped:Connect(function()
    if clickerActive then
        VirtualInputManager:SendMouseButtonEvent(clickPosition.X, clickPosition.Y, 0, true, game, 1)
        VirtualInputManager:SendMouseButtonEvent(clickPosition.X, clickPosition.Y, 0, false, game, 1)
        local spd = tonumber(speedBox.Text) or 100
        task.wait(math.max(spd/1000,0.01))
    end
end)

-- Auto Pool
local function doTeleport()
    local char = Player.Character
    if char and char:FindFirstChild("HumanoidRootPart") and autoPoolActive then
        char.HumanoidRootPart.CFrame = CFrame.new(pools[selectedPool])
        hasTeleported=true
    end
end

RunService.RenderStepped:Connect(function()
    local char = Player.Character
    if char and char:FindFirstChild("HumanoidRootPart") and autoPoolActive then
        local pos = char.HumanoidRootPart.Position
        if lastPos and (pos-lastPos).Magnitude>1 then hasTeleported=false end
        lastPos=pos
    end
end)

task.spawn(function()
    while true do
        if autoPoolActive and not hasTeleported then doTeleport() end
        task.wait(0.4)
    end
end)

-- Auto Item Press (1,2,3)
local function pressItem(key)
    local char = Player.Character
    if char then
        game:GetService("VirtualInputManager"):SendKeyEvent(true,key,false,game)
        game:GetService("VirtualInputManager"):SendKeyEvent(false,key,false,game)
    end
end

RunService.RenderStepped:Connect(function()
    for i=1,3 do
        if itemStates[i] then
            pressItem(Enum.KeyCode["One".."Two".."Three"]:sub(i,i)) -- Daha doğru çözüm: KeyCode One, Two, Three
        end
    end
end)

-- Death / Respawn handler
local function setupDeathHandler()
    local function connectDied()
        local char = Player.Character
        if char then
            local hum = char:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.Died:Connect(function()
                    hasTeleported=false
                    task.wait(1)
                    Player.CharacterAdded:Wait()
                    task.wait(0.5)
                end)
            end
        end
    end
    Player.CharacterAdded:Connect(function() task.wait(0.5); connectDied() end)
    connectDied()
end
setupDeathHandler()
